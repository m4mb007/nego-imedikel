<div class="bg-gray-50 min-h-screen">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- Breadcrumbs -->
    <nav class="flex mb-8" aria-label="Breadcrumb">
      <ol class="inline-flex items-center space-x-1 md:space-x-3">
        <li class="inline-flex items-center">
          <%= link_to root_path, class: "inline-flex items-center text-sm font-medium text-gray-700 hover:text-green-600" do %>
            <i class="fas fa-home mr-2"></i>
            Home
          <% end %>
        </li>
        <li>
          <div class="flex items-center">
            <i class="fas fa-chevron-right text-gray-400 mx-2"></i>
            <%= link_to @product.category.name, category_path(@product.category), 
                class: "text-sm font-medium text-gray-700 hover:text-green-600" %>
          </div>
        </li>
        <li aria-current="page">
          <div class="flex items-center">
            <i class="fas fa-chevron-right text-gray-400 mx-2"></i>
            <span class="text-sm font-medium text-gray-500"><%= @product.name %></span>
          </div>
        </li>
      </ol>
    </nav>

    <div class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 p-8">
        <!-- Product Images -->
        <div class="space-y-4">
          <!-- Main Image -->
          <div class="aspect-w-1 aspect-h-1 bg-gray-200 rounded-lg overflow-hidden">
            <% if @product.product_images.any? %>
              <%= image_tag @product.product_images.first.image.url, 
                  class: "w-full h-96 object-cover", 
                  alt: @product.name %>
            <% else %>
              <div class="w-full h-96 bg-gray-200 flex items-center justify-center">
                <i class="fas fa-image text-gray-400 text-6xl"></i>
              </div>
            <% end %>
          </div>

          <!-- Thumbnail Images -->
          <% if @product.product_images.count > 1 %>
            <div class="grid grid-cols-4 gap-2">
              <% @product.product_images.each do |image| %>
                <div class="aspect-w-1 aspect-h-1 bg-gray-200 rounded-lg overflow-hidden cursor-pointer hover:opacity-75">
                  <%= image_tag image.image.url, 
                      class: "w-full h-20 object-cover", 
                      alt: @product.name %>
                </div>
              <% end %>
            </div>
          <% end %>
        </div>

        <!-- Product Details -->
        <div class="space-y-6">
          <!-- Product Header -->
          <div>
            <div class="text-sm text-green-600 font-medium mb-2">
              <%= @product.category.name %>
            </div>
            <h1 class="text-3xl font-bold text-gray-900 mb-2"><%= @product.name %></h1>
            
            <!-- Rating -->
            <div class="flex items-center mb-4">
              <div class="flex items-center">
                <% 5.times do |i| %>
                  <i class="fas fa-star text-lg <%= i < @average_rating.to_i ? 'text-yellow-400' : 'text-gray-300' %>"></i>
                <% end %>
              </div>
              <span class="text-gray-600 ml-2">
                <%= @average_rating %> (<%= @reviews_count %> reviews)
              </span>
            </div>

            <!-- Price -->
            <div class="text-3xl font-bold text-gray-900 mb-4">
              RM <%= number_with_precision(@product.price, precision: 2) %>
            </div>

            <!-- Seller Info -->
            <div class="flex items-center mb-4">
              <span class="text-sm text-gray-600">Sold by:</span>
              <% if @product.user.store %>
                <%= link_to store_path(@product.user.store), 
                    class: "text-sm text-green-600 hover:text-green-700 ml-1" do %>
                  <%= @product.user.store.name %>
                <% end %>
              <% else %>
                <span class="text-sm text-gray-900 ml-1"><%= @product.user.full_name %></span>
              <% end %>
            </div>
          </div>

          <!-- Product Description -->
          <div>
            <h3 class="text-lg font-semibold text-gray-900 mb-3">Description</h3>
            <div class="text-gray-700 leading-relaxed">
              <%= simple_format(@product.description) %>
            </div>
          </div>

          <!-- Product Details -->
          <div class="grid grid-cols-2 gap-4">
            <div>
              <span class="text-sm text-gray-600">SKU:</span>
              <span class="text-sm text-gray-900 ml-1"><%= @product.sku %></span>
            </div>
            <div>
              <span class="text-sm text-gray-600">Brand:</span>
              <span class="text-sm text-gray-900 ml-1"><%= @product.brand %></span>
            </div>
            <div>
              <span class="text-sm text-gray-600">Weight:</span>
              <span class="text-sm text-gray-900 ml-1"><%= @product.weight %>g</span>
            </div>
            <div>
              <span class="text-sm text-gray-600">Stock:</span>
              <span class="text-sm <%= @product.in_stock? ? 'text-green-600' : 'text-red-600' %> ml-1">
                <%= @product.stock_quantity %> available
              </span>
            </div>
          </div>

          <!-- Purchase Actions -->
          <div class="space-y-4">
            <% if @product.in_stock? %>
              <div class="flex space-x-4">
                <%= link_to add_to_cart_product_path(@product), 
                    data: { turbo_method: :post },
                    class: "flex-1 bg-green-600 text-white font-semibold py-3 px-6 rounded-lg hover:bg-green-700 text-center" do %>
                  <i class="fas fa-shopping-cart mr-2"></i>
                  Add to Cart
                <% end %>
                
                <% if user_signed_in? %>
                  <%= link_to add_to_wishlist_product_path(@product), 
                      data: { turbo_method: :post },
                      class: "bg-gray-100 text-gray-700 p-3 rounded-lg hover:bg-gray-200",
                      title: "Add to Wishlist" do %>
                    <i class="fas fa-heart"></i>
                  <% end %>
                <% end %>
              </div>
            <% else %>
              <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                <div class="flex items-center">
                  <i class="fas fa-exclamation-triangle text-red-400 mr-2"></i>
                  <span class="text-red-800 font-medium">Out of Stock</span>
                </div>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    </div>

    <!-- Reviews Section -->
    <div class="mt-8 bg-white rounded-lg shadow-sm border border-gray-200 p-8">
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-bold text-gray-900">Customer Reviews</h2>
        <% if user_signed_in? %>
          <%= link_to new_product_review_path(@product), 
              class: "bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700" do %>
            <i class="fas fa-plus mr-2"></i>
            Write a Review
          <% end %>
        <% end %>
      </div>

      <% if @reviews.any? %>
        <div class="space-y-6">
          <% @reviews.each do |review| %>
            <div class="border-b border-gray-200 pb-6 last:border-b-0">
              <div class="flex items-center justify-between mb-2">
                <div class="flex items-center">
                  <div class="w-10 h-10 bg-green-100 rounded-full flex items-center justify-center mr-3">
                    <span class="text-green-600 font-medium text-sm">
                      <%= review.user.first_name.first.upcase %>
                    </span>
                  </div>
                  <div>
                    <div class="font-medium text-gray-900"><%= review.user.full_name %></div>
                    <div class="text-sm text-gray-500"><%= review.created_at.strftime("%B %d, %Y") %></div>
                  </div>
                </div>
                <div class="flex items-center">
                  <% 5.times do |i| %>
                    <i class="fas fa-star text-sm <%= i < review.rating ? 'text-yellow-400' : 'text-gray-300' %>"></i>
                  <% end %>
                </div>
              </div>
              <div class="text-gray-700">
                <%= simple_format(review.comment) %>
              </div>
            </div>
          <% end %>
        </div>
      <% else %>
        <div class="text-center py-8">
          <i class="fas fa-comments text-gray-400 text-4xl mb-4"></i>
          <p class="text-gray-600">No reviews yet. Be the first to review this product!</p>
        </div>
      <% end %>
    </div>

    <!-- Related Products -->
    <% if @related_products.any? %>
      <div class="mt-8">
        <h2 class="text-2xl font-bold text-gray-900 mb-6">Related Products</h2>
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
          <% @related_products.each do |product| %>
            <div class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden hover:shadow-md transition-shadow duration-200">
              <!-- Product Image -->
              <div class="aspect-w-1 aspect-h-1 bg-gray-200">
                <% if product.product_images.any? %>
                  <%= image_tag product.product_images.first.image.url, 
                      class: "w-full h-48 object-cover", 
                      alt: product.name %>
                <% else %>
                  <div class="w-full h-48 bg-gray-200 flex items-center justify-center">
                    <i class="fas fa-image text-gray-400 text-3xl"></i>
                  </div>
                <% end %>
              </div>

              <!-- Product Info -->
              <div class="p-4">
                <h3 class="text-sm font-semibold text-gray-900 mb-2 line-clamp-2">
                  <%= link_to product.name, product_path(product), class: "hover:text-green-600" %>
                </h3>
                
                <div class="flex items-center mb-2">
                  <% 5.times do |i| %>
                    <i class="fas fa-star text-xs <%= i < product.average_rating.to_i ? 'text-yellow-400' : 'text-gray-300' %>"></i>
                  <% end %>
                  <span class="text-xs text-gray-600 ml-1">(<%= product.reviews_count %>)</span>
                </div>

                <div class="flex items-center justify-between">
                  <span class="text-lg font-bold text-gray-900">
                    RM <%= number_with_precision(product.price, precision: 2) %>
                  </span>
                  <%= link_to "View", product_path(product), 
                      class: "text-green-600 hover:text-green-700 text-sm font-medium" %>
                </div>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>
</div>
